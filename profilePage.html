<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>HealthTrack - Profile</title>
<link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet"/>
<style type="text/tailwindcss">
      :root {
        --primary-50: #eff6ff;
        --primary-100: #dbeafe;
        --primary-500: #3b82f6;
        --primary-600: #2563eb;
        --primary-700: #1d4ed8;
        --neutral-50: #f8fafc;
        --neutral-100: #f1f5f9;
        --neutral-200: #e2e8f0;
        --neutral-300: #cbd5e1;
        --neutral-400: #94a3b8;
        --neutral-600: #475569;
        --neutral-700: #334155;
        --neutral-800: #1e293b;
        --neutral-900: #0f172a;
        --danger-500: #ef4444;
        --danger-600: #dc2626;
      }
      body {
        font-family: "Inter", sans-serif;
      }
    </style>
</head>
<body class="bg-neutral-50 text-neutral-800">
<div class="flex min-h-screen flex-col">
<header class="sticky top-0 z-10 border-b border-neutral-200 bg-white">
<div class="container mx-auto flex h-16 items-center justify-between px-4 sm:px-6 lg:px-8">
<a class="flex items-center gap-2 text-xl font-bold text-blue-600" href="HomePage.html">
  <span class="material-icons-outlined text-3xl text-blue-600">health_and_safety</span>
  HealthTrack
</a>
<div class="flex items-center gap-4">
<button class="rounded-full p-2 text-neutral-600 hover:bg-neutral-100 hover:text-neutral-800 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2">
<span class="sr-only">View notifications</span>
<svg fill="currentColor" height="24" viewBox="0 0 256 256" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M221.8,175.94C216.25,166.38,208,139.33,208,104a80,80,0,1,0-160,0c0,35.34-8.26,62.38-13.81,71.94A16,16,0,0,0,48,200H88.81a40,40,0,0,0,78.38,0H208a16,16,0,0,0,13.8-24.06ZM128,216a24,24,0,0,1-22.62-16h45.24A24,24,0,0,1,128,216ZM48,184c7.7-13.24,16-43.92,16-80a64,64,0,1,1,128,0c0,36.05,8.28,66.73,16,80Z"></path>
</svg>
</button>
<div class="relative">
<button class="flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 rounded-full">
<img alt="User avatar" class="h-10 w-10 rounded-full" src="https://lh3.googleusercontent.com/aida-public/AB6AXuBWGK3VF6z0raxajLqQ_Mfe60QRAbJC1MuKAK71n4z6hAzBQPGEjp9kXm4HjyHyLMlje5Hpy86PnzAzl0BUTY9a5iz3z9MYmDQauraKFjiRm5qFJ9uRjx2FJPeXgOfe4yUxxNFRQiEblaeh94Q9WQfseCOu5avNp9aI1W9f6dV6O6cLpLpzRgNDPYYMd5c1ZA3v9HYJbQOCiCrJRxQ4u31gxBaWVf8tjJXGCmtbGL51bwjU6rGveEd8wQwvy9AeVC1dp_VL1iGosuo"/>
</button>
</div>
</div>
</div>
</header>
<main class="flex-grow bg-neutral-100 py-8">
<div class="container mx-auto px-4 sm:px-6 lg:px-8">
<div class="mx-auto max-w-2xl">
<div class="mb-8 text-center">
<h1 class="text-3xl font-bold tracking-tight text-neutral-900 sm:text-4xl">Profile Settings</h1>
<p class="mt-2 text-lg text-neutral-600">Manage your personal information and account settings.</p>
</div>
<div class="rounded-lg bg-white p-6 shadow-sm sm:p-8">
<form action="" class="space-y-6" method="POST">
<div class="flex items-center gap-6">
<img alt="User avatar" class="h-20 w-20 rounded-full" src="https://lh3.googleusercontent.com/aida-public/AB6AXuBWGK3VF6z0raxajLqQ_Mfe60QRAbJC1MuKAK71n4z6hAzBQPGEjp9kXm4HjyHyLMlje5Hpy86PnzAzl0BUTY9a5iz3z9MYmDQauraKFjiRm5qFJ9uRjx2FJPeXgOfe4yUxxNFRQiEblaeh94Q9WQfseCOu5avNp9aI1W9f6dV6O6cLpLpzRgNDPYYMd5c1ZA3v9HYJbQOCiCrJRxQ4u31gxBaWVf8tjJXGCmtbGL51bwjU6rGveEd8wQwvy9AeVC1dp_VL1iGosuo"/>
<div>
<label class="cursor-pointer rounded-md bg-white px-3 py-2 text-sm font-semibold text-primary-600 shadow-sm ring-1 ring-inset ring-neutral-300 hover:bg-neutral-50" for="avatar-upload"> Change </label>
<input class="sr-only" id="avatar-upload" name="avatar-upload" type="file"/>
<p class="mt-2 text-xs text-neutral-400">JPG, GIF or PNG. 1MB max.</p>
</div>
</div>
<div class="grid grid-cols-1 gap-x-6 gap-y-6 sm:grid-cols-6">
<div class="sm:col-span-3">
<label class="block text-sm font-medium leading-6 text-neutral-700" for="name">Name</label>
<div class="mt-2">
<input autocomplete="name" class="block w-full rounded-md border-0 py-2.5 text-neutral-900 shadow-sm ring-1 ring-inset ring-neutral-300 placeholder:text-neutral-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm sm:leading-6" id="name" name="name" placeholder="John Doe" type="text"/>
</div>
</div>
<div class="sm:col-span-3">
<label class="block text-sm font-medium leading-6 text-neutral-700" for="email">Email address</label>
<div class="mt-2">
<input disabled autocomplete="email" class="block w-full rounded-md border-0 py-2.5 text-neutral-900 shadow-sm ring-1 ring-inset ring-neutral-300 placeholder:text-neutral-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm sm:leading-6" id="email" name="email" placeholder="you@example.com" type="email"/>
</div>
</div>
<div class="sm:col-span-3">
<label class="block text-sm font-medium leading-6 text-neutral-700" for="phone-number">Phone Number</label>
<div class="mt-2">
<input autocomplete="tel" class="block w-full rounded-md border-0 py-2.5 text-neutral-900 shadow-sm ring-1 ring-inset ring-neutral-300 placeholder:text-neutral-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm sm:leading-6" id="phone-number" name="phone-number" placeholder="(555) 123-4567" type="tel"/>
</div>
</div>
<div class="sm:col-span-3">
<label class="block text-sm font-medium leading-6 text-neutral-700" for="password">Password</label>
<div class="mt-2">
<input class="block w-full rounded-md border-0 py-2.5 text-neutral-900 shadow-sm ring-1 ring-inset ring-neutral-300 placeholder:text-neutral-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm sm:leading-6" id="password" name="password" type="password"/>
</div>
</div>
<div class="col-span-full"><hr class="border-t border-neutral-200"/></div>
<div class="sm:col-span-3">
<label class="block text-sm font-medium leading-6 text-neutral-700" for="age">Age <span class="text-neutral-400">(Optional)</span></label>
<div class="mt-2">
<input class="block w-full rounded-md border-0 py-2.5 text-neutral-900 shadow-sm ring-1 ring-inset ring-neutral-300 placeholder:text-neutral-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm sm:leading-6" id="age" name="age" placeholder="30" type="number"/>
</div>
</div>
<div class="sm:col-span-3">
<label class="block text-sm font-medium leading-6 text-neutral-700" for="gender">Gender <span class="text-neutral-400">(Optional)</span></label>
<div class="mt-2">
<select class="block w-full rounded-md border-0 py-2.5 text-neutral-900 shadow-sm ring-1 ring-inset ring-neutral-300 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm sm:leading-6" id="gender" name="gender">
<option value="" disabled selected>Select</option>
<option>Male</option>
<option>Female</option>
<option>Other</option>
<option>Prefer not to say</option>
</select>
</div>
</div>
<div class="col-span-full">
<label class="block text-sm font-medium leading-6 text-neutral-700" for="emergency-contact">Emergency Contact <span class="text-neutral-400">(Optional)</span></label>
<div class="mt-2">
<input class="block w-full rounded-md border-0 py-2.5 text-neutral-900 shadow-sm ring-1 ring-inset ring-neutral-300 placeholder:text-neutral-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm sm:leading-6" id="emergency-contact" name="emergency-contact" placeholder="Jane Doe - (555) 987-6543" type="text"/>
</div>
</div>
</div>
<div class="mt-8 flex items-center justify-end gap-x-4 border-t border-neutral-200 pt-6">
<button onclick="cancelChanges()" class="text-sm font-semibold leading-6 text-neutral-900" type="button">Cancel</button>
<button class="rounded-md bg-primary-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primary-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600" type="submit" style="color: blue;">
                    Save Changes
                  </button>
</div>
</form>
</div>
<div class="mt-6 rounded-lg bg-white p-6 shadow-sm">
<div class="flex items-center justify-between">
<div>
<h3 class="text-base font-semibold leading-6 text-neutral-900">Logout</h3>
<p class="mt-1 text-sm text-neutral-600">You will be logged out of your account.</p>
</div>
<button class="rounded-md bg-danger-500 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-danger-600" onclick="logoutUser()" style="color: blue;">Logout</button>
</div>
</div>
</div>
</div>

</main>
</div>

<script>
  function logoutUser() {
    localStorage.removeItem("token");
    alert("You have been logged out.");
    window.location.href = "index.html";
  }

  function cancelChanges() {
    if (confirm("Are you sure you want to discard changes?")) {
      document.querySelector("form").reset();
      alert("Changes discarded.");
    }
  }

  window.onload = async () => {
    const token = localStorage.getItem("token");
    if (!token) {
      alert("You must be logged in.");
      window.location.href = "index.html";
      return;
    }

    try {
      const res = await fetch("https://health-app-s67i.onrender.com/api/auth/profile", {
        headers: { Authorization: `Bearer ${token}` },
      });

      if (!res.ok) throw new Error("Unauthorized");

      const user = await res.json();

      // ✅ Fill all fields (use fallback value if null/undefined)
      document.getElementById("name").value = user.name || "";
      document.getElementById("email").value = user.email || "";
      document.getElementById("phone-number").value = user.phone || "";
      document.getElementById("age").value = user.age || "";
      document.getElementById("gender").value = user.gender || "";
      document.getElementById("emergency-contact").value = user.emergencyContact || "";

    } catch (err) {
      alert("Error fetching profile. Please log in again.");
      localStorage.removeItem("token");
      window.location.href = "index.html";
    }
  };

  const form = document.querySelector("form");
  form.addEventListener("submit", async function (e) {
    e.preventDefault();

    const token = localStorage.getItem("token");

    const updatedData = {
      
      name: document.getElementById("name").value, 
      phone: document.getElementById("phone-number").value,
      age: document.getElementById("age").value,
      gender: document.getElementById("gender").value,
      emergencyContact: document.getElementById("emergency-contact").value,
    };

    try {
      const res = await fetch("https://health-app-s67i.onrender.com/api/auth/profile", {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify(updatedData)
      });

      if (res.ok) {
        alert("✅ Profile updated successfully!");
        // Refresh data
        window.onload(); // re-call the function to refill data
      } else {
        alert("❌ Failed to update profile.");
      }
    } catch (err) {
      alert("Error: " + err.message);
    }
  });
</script>


</body></html>